# **DSP Laboratory; Week -08 Filter Analysis**

## **Aim**
Write Arduino programs for studying-
* Moving Average Filter
* Use of Auto-correlation to find the pulse rate of PPG and ECG signals


# **1. Moving Average Filter**
The moving average filter is a simple Low Pass FIR (Finite Impulse Response). It takes some samples of input and takes the mean of those to produce a single output. As the length of the filter increases, the smoothness of the output increases.
<hr />

# **2. Autocorrelation: **

Codes:
1. PPG Signal:
``` cpp
const int len=625;
const int M=4;
float ppg[len]={-0.712668672,-0.911832212,-1.028610179,-0.74426209,-0.863069078,-0.713717867,-0.520648702,-0.656235897,-0.25406834,-0.357413536,-0.149846833,0.053660732,-0.068859643,0.284883964,0.105282823,0.210610234,0.294400018,0.035710043,0.28643326,0.009246623,0.040050182,0.071974299,-0.21708006,0.011522122,-0.272198144,-0.235975465,-0.19779476,-0.468721614,-0.217554883,-0.48077987,-0.425889035,-0.361877023,-0.618812327,-0.354267674,-0.610009094,-0.54977466,-0.486973296,-0.73232257,-0.479177273,-0.726247471,-0.655629712,-0.578219047,-0.825419451,-0.548582224,-0.786344804,-0.70834636,-0.61669876,-0.84828079,-0.561304542,-0.789839624,-0.693398276,-0.593461516,-0.820128224,-0.527589791,-0.743908819,-0.642052323,-0.543110421,-0.770229707,-0.471763299,-0.700296443,-0.604940605,-0.516869822,-0.744938772,-0.465909873,-0.697722472,-0.607749641,-0.527174665,-0.763959785,-0.487692737,-0.720795759,-0.640700449,-0.563357362,-0.805450854,-0.53252131,-0.774778984,-0.695452148,-0.622408322,-0.865568307,-0.593692163,-0.826823673,-0.75285957,-0.686905544,-0.92595283,-0.651316985,-0.88667583,-0.802290195,-0.725867711,-0.955982718,-0.674960528,-0.923634337,-0.839302689,-0.749767298,-0.994532128,-0.705760855,-0.949537802,-0.861013917,-0.781162509,-1.011260062,-0.731690297,-0.97130254,-0.877087376,-0.798432998,-1.03423901,-0.749465182,-0.990497027,-0.901304383,-0.817561056,-1.05316606,-0.766113235,-0.987845195,-0.858360885,-0.711745729,-0.859626655,-0.479089338,-0.603198613,-0.409485932,-0.197492893,-0.295270139,0.121748099,0.003368142,0.187026367,0.342059587,0.155525803,0.440003695,0.189352047,0.239700211,0.27647554,-0.012943788,0.210100577,-0.08788574,-0.057078209,-0.02495663,-0.317277528,-0.079007086,-0.353146854,-0.308484891,-0.255521423,-0.521995252,-0.25546766,-0.514350981,-0.450918866,-0.381432693,-0.64471006,-0.382427619,-0.630428364,-0.569051281,-0.500924546,-0.74725831,-0.479689247,-0.719796585,-0.653391543,-0.563015398,-0.805878158,-0.523412326,-0.755170965,-0.66951254,-0.576593314,-0.803091078,-0.501253698,-0.729547932,-0.62498439,-0.526579636,-0.753719073,-0.457174765,-0.678809967,-0.584411973,-0.483906404,-0.718961403,-0.425133102,-0.652087027,-0.561766616,-0.477328629,-0.699472565,-0.428599681,-0.659507543,-0.578270152,-0.495982456,-0.737627042,-0.463739107,-0.697205766,-0.625870803,-0.551487336,-0.790507428,-0.523154723,-0.758922988,-0.679346372,-0.603997028,-0.846208077,-0.575220383,-0.81875428,-0.73502468,-0.66754563,-0.901991504,-0.626707047,-0.864263405,-0.778635863,-0.703821743,-0.946613019,-0.669842864,-0.914095316,-0.818814706,-0.731484531,-0.976846187,-0.694632639,-0.921686547,-0.850172973,-0.759306518,-0.995756097,-0.706235036,-0.947632797,-0.851929852,-0.771734055,-1.003583867,-0.719472307,-0.952188594,-0.868300642,-0.776014198,-1.015900924,-0.709621503,-0.910525663,-0.758799693,-0.581705887,-0.716565269,-0.327563745,-0.435674608,-0.208845222,0.012588026,-0.08472478,0.321178547,0.196757864,0.342673722,0.461669068,0.225418689,0.486904796,0.207533521,0.242456237,0.264863771,-0.033513082,0.189191267,-0.101718568,-0.07348497,-0.041441829,-0.323157295,-0.090943315,-0.356453921,-0.306412602,-0.247652449,-0.509799913,-0.252852762,-0.505523599,-0.437308801,-0.38208159,-0.628810188,-0.364608246,-0.615644868,-0.557573223,-0.491180031,-0.729925095,-0.457776049,-0.694297622,-0.614801917,-0.53318561,-0.760755051,-0.468940815,-0.70037996,-0.606216893,-0.509182888,-0.726083746,-0.425862123,-0.646635806,-0.546207958,-0.44013644,-0.661624492,-0.367238238,-0.589725576,-0.499606939,-0.412057891,-0.639515621,-0.349256499,-0.583675355,-0.506616148,-0.411733081,-0.643155927,-0.367553145,-0.608098156,-0.527781091,-0.450848978,-0.69721697,-0.42467544,-0.66661969,-0.599763965,-0.518458622,-0.759603104,-0.481911706,-0.73316256,-0.648592373,-0.579869229,-0.815042745,-0.541221401,-0.786446545,-0.709262266,-0.629596708,-0.872230479,-0.603054388,-0.826802482,-0.761675765,-0.681141814,-0.91587693,-0.636528735,-0.873570477,-0.782777396,-0.699122669,-0.937982958,-0.659834275,-0.891730652,-0.816193969,-0.713788079,-0.945587371,-0.667616961,-0.893366652,-0.812402331,-0.730583205,-0.957697076,-0.665898655,-0.898589229,-0.81365652,-0.736881903,-0.950596421,-0.64126353,-0.820675308,-0.655431653,-0.466792284,-0.592147587,-0.183026685,-0.27288594,-0.03397912,0.197801832,0.104498679,0.513972283,0.358970321,0.498174331,0.603771103,0.359441466,0.59555046,0.310862781,0.338743412,0.350562709,0.05068263,0.268093417,-0.0285643,0.005579577,0.043570716,-0.235941107,0.007255835,-0.260707763,-0.203053665,-0.144942285,-0.398786058,-0.140813266,-0.383058561,-0.319206592,-0.256582143,-0.51589187,-0.257740198,-0.500104938,-0.442775893,-0.370786574,-0.615161776,-0.348722511,-0.583915836,-0.507073661,-0.419848058,-0.651487384,-0.362285925,-0.579393639,-0.493928757,-0.391864684,-0.609348812,-0.309648931,-0.524985912,-0.424976354,-0.322917294,-0.546119463,-0.245961131,-0.471788587,-0.377469687,-0.292519673,-0.518044784,-0.242607065,-0.480857538,-0.403907291,-0.325130007,-0.567666651,-0.291883121,-0.532040321,-0.463227027,-0.378046751,-0.624986752,-0.357334597,-0.60010769,-0.530060698,-0.458785686,-0.697960096,-0.421212982,-0.671493406,-0.594172422,-0.514722984,-0.761274944,-0.487131028,-0.722803194,-0.651307401,-0.566039466,-0.810562119,-0.541032941,-0.7753776,-0.699333151,-0.617665597,-0.85704697,-0.576629452,-0.816303538,-0.737705901,-0.642499278,-0.882653028,-0.602338699,-0.830040826,-0.75699273,-0.672594402,-0.897190148,-0.61813662,-0.84773023,-0.763129804,-0.670410762,-0.897452897,-0.617158798,-0.859587862,-0.772044326,-0.678352566,-0.906365489,-0.621325421,-0.852970799,-0.763937101,-0.661355052,-0.84422084,-0.493866843,-0.630446124,-0.443928194,-0.241409402,-0.328149637,0.098054001,0.019094748,0.253348974,0.462316766,0.32824693,0.669762266,0.468014265,0.552006423,0.604258298,0.325796826,0.546763424,0.240075418,0.262708949,0.275043066,-0.015944528,0.206934681,-0.08934249,-0.056088099,-0.013751313,-0.282483061,-0.031979971,-0.295839166,-0.239699067,-0.172543977,-0.415890764,-0.147509195,-0.391033183,-0.332276584,-0.265214802,-0.516994204,-0.252646646,-0.510238516,-0.443269587,-0.372134466,-0.62375841,-0.348263344,-0.581828989,-0.497986606,-0.415894403,-0.637141278,-0.34623383,-0.56681364,-0.471062786,-0.373414327,-0.587030321,-0.295545016,-0.509678334,-0.411067513,-0.315756532,-0.535588993,-0.235141824,-0.470944049,-0.383479927,-0.298394866,-0.535161923,-0.259732324,-0.490103204,-0.410654891,-0.336919014,-0.580578361,-0.311150471,-0.556216371,-0.471646949,-0.408727453,-0.652061149,-0.383172646,-0.627615542,-0.55873382,-0.477362148,-0.722118296,-0.447954989,-0.693908416,-0.618040789,-0.539430645,-0.787281466,-0.50592487,-0.753788887,-0.674153469,-0.596740948,-0.831386206,-0.558018984,-0.806158778,-0.7207448,-0.645779739,-0.88372487,-0.596642551,-0.843539117,-0.74398957,-0.669126236,-0.902692928,-0.62928642,-0.860122605,-0.770252327,-0.688825565,-0.92097509,-0.631011012,-0.86402964,-0.779961097,-0.690418095,-0.925980622,-0.641288212,-0.873771974,-0.792485692,-0.699299603,-0.927753749,-0.647030537,-0.881766254,-0.798453109,-0.707892839,-0.940584676,-0.64890229,-0.879885922,-0.788815263,-0.697975398,-0.913033579,-0.599473444,-0.768773737,-0.593667769,-0.410741462,-0.525906227,-0.1166419,-0.207119029,0.024910348,0.263307105,0.165682216,0.566668247,0.40765823,0.535823858,0.6165418,0.350744654,0.59325138,0.29761176,0.3044753,0.323284394,0.016695194,0.226680521,-0.068837018,-0.044603832,-0.008711191,-0.282808069,-0.051961755,-0.314513497,-0.253607522,-0.198689763,-0.448617366,-0.188407675,-0.441526553,-0.366588226,-0.299833109,-0.557262087,-0.290306408,-0.542160727,-0.472441955,-0.406480686,-0.651905404,-0.379446176,-0.624570666,-0.538917464,-0.451601443,-0.681213793,-0.383451536,-0.614362764,-0.519947283,-0.420908136,-0.630066087,-0.338855684,-0.550942926,-0.449204089,-0.354012095,-0.573343479,-0.281447713,-0.499288967,-0.404207481,-0.322688998,-0.553372624,-0.270926827,-0.502051355};

void setup() {
// put your setup code here, to run once:
  Serial.begin(9600);
  }


void loop() {
//a) 4-point moving average filter
 
  float y[625];
  int c=0;
  for(int j=0; j<(len-4); j++){
    float sum = 0;
    for(int k=c; k<c+4; k++){
      sum= sum+ ppg[k];
    }
    y[c]= sum;
    c=c+1;
  }
  
  for(int l=0; l<4; l++){
    float sum = 0;
    for(int k=c; k<c+4-l; k++){
      sum=sum+ppg[k];
    }
    y[c]=sum;
    c=c+1;
  }

  for(int q=0;q<len;q++){
    y[q]=y[q]/4;
  }

  for(int l=0; l<len;l++){
    //Serial.print(ppg[l]);
    //Serial.print(',');
    //Serial.println(y[l]+5);

  }

//b)
  float sum=0;
  for ( int k=0;k<625;k++){
    sum=sum+y[k];
    }
    
  float mean=sum/625;

  for (int k=0;k<625;k++){
    y[k]=y[k]-mean;
    }

  int sample;
  float z[625]; //ACF
  for (int i=0;i<625;i++){
    float temp=0;
      for(int j=0;j<625-i;j++){
        temp=temp+(y[j]*y[j+i]);
      }
      z[i]=temp;
    }

  float maximum=z[0];

  for ( int o=0;o<625;o++){
    z[o]=z[o]/maximum; //Normalizing the ACF
    }

  
  for ( int i=1;i<625;i++){
    if ( (z[i-1] < z[i]) && (z[i+1] < z[i]) && z[i]>0 ) {
      sample=i;
      break;
    }
  }

  float pulserate=60*125/sample;
  Serial.print(pulserate);
  }
   
```

2. ECG Signal:
const int len=1800;
const int M=4;
float ecg[len]={-0.69671,-0.75135,-0.71145,-0.66366,-0.66699,-0.71344,-0.74863,-0.73202,-0.67865,-0.64,-0.65313,-0.70837,-0.75862,-0.76257,-0.71962,-0.66478,-0.63833,-0.65612,-0.70056,-0.73868,-0.74631,-0.72137,-0.68395,-0.66187,-0.67191,-0.71039,-0.75396,-0.7736,-0.75591,-0.71176,-0.6693,-0.65612,-0.67625,-0.70877,-0.72381,-0.70082,-0.64599,-0.58879,-0.55875,-0.56767,-0.60052,-0.6231,-0.60926,-0.55724,-0.48864,-0.43751,-0.42371,-0.43826,-0.45588,-0.45034,-0.41383,-0.36767,-0.34164,-0.35281,-0.39644,-0.445,-0.46996,-0.46483,-0.44568,-0.44142,-0.47374,-0.53781,-0.60831,-0.65725,-0.67072,-0.66164,-0.65858,-0.68267,-0.73535,-0.79481,-0.83049,-0.82791,-0.79647,-0.76387,-0.75762,-0.78409,-0.82679,-0.85645,-0.85219,-0.81805,-0.7776,-0.75786,-0.77137,-0.80723,-0.83788,-0.84012,-0.81218,-0.77262,-0.74939,-0.75909,-0.79117,-0.81781,-0.8116,-0.76226,-0.68682,-0.61138,-0.54744,-0.48622,-0.3994,-0.25985,-0.066131,0.16033,0.38495,0.57133,0.69668,0.74945,0.72316,0.61989,0.44793,0.22206,-0.033181,-0.29047,-0.52179,-0.69961,-0.8095,-0.85552,-0.8593,-0.8553,-0.86802,-0.89615,-0.92075,-0.91798,-0.8802,-0.82898,-0.79553,-0.79871,-0.83382,-0.87214,-0.88331,-0.85915,-0.81604,-0.7828,-0.7812,-0.80882,-0.8405,-0.84924,-0.82445,-0.77862,-0.74114,-0.73516,-0.76134,-0.79741,-0.81256,-0.79234,-0.74659,-0.70224,-0.68782,-0.70843,-0.74364,-0.7643,-0.74953,-0.70397,-0.65545,-0.63226,-0.6455,-0.68098,-0.70755,-0.7019,-0.66373,-0.61403,-0.58241,-0.58388,-0.60775,-0.62842,-0.62103,-0.57854,-0.51971,-0.47278,-0.45575,-0.46735,-0.48361,-0.47523,-0.43154,-0.36456,-0.30271,-0.27328,-0.27896,-0.29761,-0.2997,-0.26694,-0.20853,-0.15516,-0.13346,-0.14933,-0.18347,-0.20376,-0.19268,-0.15854,-0.12715,-0.12713,-0.16713,-0.22893,-0.28522,-0.31461,-0.31523,-0.30933,-0.32275,-0.36708,-0.43443,-0.49874,-0.53475,-0.53829,-0.52643,-0.52726,-0.56141,-0.62398,-0.68891,-0.72754,-0.72639,-0.69882,-0.67572,-0.68172,-0.72025,-0.77063,-0.80114,-0.79457,-0.75906,-0.721,-0.70967,-0.73399,-0.77576,-0.80572,-0.80219,-0.76689,-0.72618,-0.70916,-0.72746,-0.76825,-0.80076,-0.80003,-0.76541,-0.71833,-0.68952,-0.69677,-0.7305,-0.76418,-0.7714,-0.74277,-0.69648,-0.66237,-0.6601,-0.69006,-0.72863,-0.74521,-0.72795,-0.68787,-0.65254,-0.64893,-0.6796,-0.7222,-0.7466,-0.73327,-0.6901,-0.6473,-0.63313,-0.65669,-0.70058,-0.73167,-0.72816,-0.69305,-0.65076,-0.63274,-0.65196,-0.69333,-0.72811,-0.73113,-0.69943,-0.65743,-0.63523,-0.64784,-0.68635,-0.72069,-0.72284,-0.68787,-0.63399,-0.59149,-0.58211,-0.60195,-0.62796,-0.63442,-0.6082,-0.56042,-0.51634,-0.49489,-0.49886,-0.51039,-0.50238,-0.4633,-0.40369,-0.34969,-0.33073,-0.35372,-0.39803,-0.4332,-0.43576,-0.40726,-0.37567,-0.37109,-0.40576,-0.46674,-0.52193,-0.54591,-0.53854,-0.5219,-0.52714,-0.57106,-0.64137,-0.7082,-0.74269,-0.73551,-0.70619,-0.68674,-0.69935,-0.74291,-0.79178,-0.81626,-0.80266,-0.76293,-0.72838,-0.72463,-0.75448,-0.79714,-0.82149,-0.80842,-0.76564,-0.72246,-0.70755,-0.73052,-0.77499,-0.807,-0.8014,-0.75801,-0.69868,-0.65446,-0.63946,-0.6369,-0.6135,-0.53731,-0.39769,-0.21578,-0.023144,0.15866,0.32467,0.4848,0.64201,0.77397,0.84107,0.80399,0.64754,0.39746,0.10778,-0.16372,-0.37754,-0.52897,-0.63861,-0.72956,-0.81359,-0.88198,-0.91428,-0.90255,-0.85882,-0.81091,-0.79071,-0.80805,-0.84492,-0.87141,-0.86315,-0.82034,-0.76995,-0.74344,-0.75508,-0.79318,-0.82673,-0.8274,-0.79162,-0.74157,-0.70778,-0.71017,-0.74259,-0.77669,-0.784,-0.75412,-0.70345,-0.66265,-0.65428,-0.68009,-0.71599,-0.72995,-0.70735,-0.65761,-0.60966,-0.59236,-0.61044,-0.64329,-0.66003,-0.64036,-0.59238,-0.54586,-0.52893,-0.54964,-0.58795,-0.6095,-0.59302,-0.54325,-0.48699,-0.45635,-0.4629,-0.48961,-0.50615,-0.48705,-0.43023,-0.36164,-0.31316,-0.30158,-0.31918,-0.3356,-0.32094,-0.26854,-0.19665,-0.13788,-0.11742,-0.13283,-0.15906,-0.16667,-0.14061,-0.094017,-0.057702,-0.056092,-0.093506,-0.14924,-0.19096,-0.20173,-0.18861,-0.17603,-0.19228,-0.24485,-0.31526,-0.37569,-0.40499,-0.40438,-0.39882,-0.4156,-0.4657,-0.5372,-0.60059,-0.63094,-0.62633,-0.60655,-0.6007,-0.62666,-0.6764,-0.72406,-0.74437,-0.72917,-0.6959,-0.67435,-0.68393,-0.72265,-0.76638,-0.78493,-0.76671,-0.72512,-0.68923,-0.68582,-0.71743,-0.76062,-0.78452,-0.77042,-0.72675,-0.68425,-0.67131,-0.6956,-0.73866,-0.76692,-0.75883,-0.71888,-0.67211,-0.64981,-0.66477,-0.70127,-0.73129,-0.73102,-0.69767,-0.65592,-0.63556,-0.65101,-0.69407,-0.73525,-0.74618,-0.7216,-0.67915,-0.64896,-0.65313,-0.68738,-0.72736,-0.74591,-0.72999,-0.69316,-0.66437,-0.66576,-0.7002,-0.74625,-0.77197,-0.7611,-0.72165,-0.68076,-0.66963,-0.69705,-0.74388,-0.77889,-0.77729,-0.73984,-0.69358,-0.66874,-0.67856,-0.71068,-0.73372,-0.72295,-0.67855,-0.62322,-0.58915,-0.59419,-0.62676,-0.65758,-0.65771,-0.61646,-0.5527,-0.49803,-0.47356,-0.48128,-0.49958,-0.5002,-0.47394,-0.43252,-0.40105,-0.4028,-0.43753,-0.48308,-0.51314,-0.51195,-0.4883,-0.47039,-0.48268,-0.53187,-0.60154,-0.6605,-0.68805,-0.68635,-0.67615,-0.68526,-0.72536,-0.7823,-0.82951,-0.84383,-0.82317,-0.78999,-0.77324,-0.79021,-0.83262,-0.87244,-0.88382,-0.85936,-0.81634,-0.78594,-0.79011,-0.82516,-0.86594,-0.88382,-0.86512,-0.82366,-0.79012,-0.78678,-0.8143,-0.84803,-0.85184,-0.80725,-0.72165,-0.61981,-0.52994,-0.45587,-0.37273,-0.24793,-0.060421,0.17852,0.42213,0.61488,0.71642,0.71538,0.63126,0.49264,0.31891,0.11884,-0.10578,-0.34522,-0.57222,-0.75488,-0.8698,-0.91396,-0.91266,-0.90185,-0.90691,-0.93493,-0.96823,-0.97973,-0.95855,-0.91462,-0.87458,-0.86628,-0.89412,-0.93632,-0.96155,-0.94821,-0.90144,-0.85096,-0.82774,-0.84172,-0.87727,-0.9034,-0.89572,-0.85614,-0.80868,-0.7821,-0.79008,-0.82009,-0.84569,-0.8432,-0.80835,-0.76268,-0.73362,-0.73656,-0.76578,-0.79438,-0.79582,-0.76362,-0.71344,-0.67488,-0.67001,-0.69541,-0.72737,-0.73715,-0.7103,-0.66007,-0.61545,-0.59978,-0.61696,-0.64552,-0.65377,-0.62573,-0.56892,-0.5093,-0.4766,-0.47874,-0.49771,-0.50516,-0.4785,-0.41866,-0.35148,-0.30584,-0.29569,-0.31156,-0.32432,-0.30886,-0.26214,-0.20246,-0.15991,-0.15428,-0.17911,-0.21087,-0.22422,-0.20849,-0.17975,-0.1659,-0.18513,-0.23759,-0.30052,-0.34432,-0.35789,-0.35202,-0.35228,-0.38335,-0.44671,-0.52022,-0.57564,-0.59543,-0.58715,-0.5794,-0.59824,-0.65045,-0.71853,-0.77046,-0.78473,-0.76506,-0.73551,-0.72632,-0.75134,-0.79693,-0.83551,-0.8436,-0.81767,-0.78006,-0.76018,-0.7729,-0.81063,-0.84598,-0.85175,-0.82305,-0.77828,-0.74739,-0.75218,-0.78811,-0.82925,-0.8468,-0.82654,-0.78149,-0.74192,-0.73198,-0.75673,-0.79659,-0.8198,-0.80939,-0.77153,-0.73005,-0.71439,-0.73322,-0.76909,-0.79496,-0.78925,-0.75333,-0.71324,-0.69669,-0.71503,-0.75583,-0.78806,-0.78713,-0.75269,-0.70657,-0.68099,-0.69452,-0.73696,-0.78015,-0.79531,-0.77223,-0.72993,-0.69962,-0.70212,-0.73694,-0.7787,-0.79635,-0.77853,-0.73768,-0.70255,-0.6993,-0.72896,-0.76841,-0.78758,-0.76766,-0.71682,-0.66464,-0.63863,-0.64808,-0.67715,-0.69399,-0.6774,-0.63007,-0.57437,-0.53992,-0.5385,-0.55353,-0.55713,-0.5272,-0.4647,-0.39978,-0.36604,-0.37773,-0.42315,-0.46818,-0.48212,-0.46154,-0.42773,-0.41306,-0.43893,-0.49724,-0.55976,-0.59853,-0.60276,-0.58976,-0.5909,-0.62647,-0.69445,-0.76838,-0.81352,-0.81478,-0.784,-0.75182,-0.74979,-0.7853,-0.8387,-0.87737,-0.87779,-0.84408,-0.80257,-0.78361,-0.80153,-0.8427,-0.87658,-0.87931,-0.85013,-0.80962,-0.78633,-0.7963,-0.82999,-0.86299,-0.87096,-0.84239,-0.78977,-0.73815,-0.70612,-0.69621,-0.68337,-0.62681,-0.50131,-0.31205,-0.095896,0.099504,0.25473,0.38759,0.52717,0.67828,0.79553,0.80319,0.65219,0.35888,0.0039053,-0.31161,-0.52843,-0.65143,-0.72618,-0.80053,-0.88784,-0.96527,-1.0052,-0.99547,-0.94891,-0.89926,-0.87501,-0.8849,-0.91804,-0.94689,-0.94643,-0.91295,-0.86382,-0.82836,-0.82883,-0.86148,-0.89908,-0.9114,-0.88551,-0.83487,-0.79203,-0.78331,-0.80928,-0.84703,-0.8644,-0.84444,-0.79647,-0.7481,-0.72886,-0.74543,-0.77853,-0.79968,-0.78778,-0.74652,-0.70268,-0.68335,-0.69882,-0.73464,-0.75935,-0.74978,-0.70638,-0.6517,-0.61753,-0.62025,-0.64864,-0.67469,-0.67067,-0.62859,-0.5689,-0.52258,-0.50936,-0.52714,-0.54951,-0.5456,-0.50474,-0.43974,-0.37924,-0.34956,-0.35273,-0.36761,-0.36648,-0.33146,-0.26982,-0.20949,-0.17691,-0.18172,-0.20928,-0.22821,-0.21608,-0.17388,-0.12417,-0.09989,-0.11858,-0.16849,-0.22144,-0.249,-0.24227,-0.22246,-0.22086,-0.25675,-0.32667,-0.40298,-0.45458,-0.47107,-0.46595,-0.46768,-0.49992,-0.56118,-0.6278,-0.67182,-0.67899,-0.66145,-0.64852,-0.66291,-0.70654,-0.75822,-0.78755,-0.78018,-0.74659,-0.71315,-0.7069,-0.7342,-0.77622,-0.80551,-0.80246,-0.76863,-0.72795,-0.70752,-0.71981,-0.75605,-0.78976,-0.79686,-0.7735,-0.73639,-0.71311,-0.72175,-0.75508,-0.78854,-0.79624,-0.76811,-0.72177,-0.68732,-0.68488,-0.71492,-0.75357,-0.77001,-0.75268,-0.71289,-0.67794,-0.6743,-0.70422,-0.74585,-0.77046,-0.75956,-0.7208,-0.68292,-0.67214,-0.69639,-0.73871,-0.76758,-0.76316,-0.72978,-0.69149,-0.67831,-0.70159,-0.74506,-0.7798,-0.7809,-0.74566,-0.69898,-0.67191,-0.68132,-0.72038,-0.76008,-0.77157,-0.7474,-0.70289,-0.66663,-0.65994,-0.67907,-0.70099,-0.70001,-0.66455,-0.60951,-0.56492,-0.55274,-0.57475,-0.60771,-0.617,-0.58485,-0.51904,-0.44702,-0.40312,-0.40074,-0.42517,-0.4491,-0.4477,-0.41755,-0.38136,-0.36704,-0.38944,-0.44104,-0.49328,-0.51943,-0.5141,-0.49408,-0.48993,-0.52333,-0.58894,-0.66159,-0.71161,-0.72341,-0.70982,-0.69902,-0.71296,-0.75507,-0.80436,-0.83188,-0.82353,-0.78855,-0.75548,-0.75061,-0.77928,-0.82388,-0.85421,-0.85025,-0.81771,-0.78257,-0.77182,-0.79529,-0.83796,-0.86877,-0.86564,-0.83046,-0.78506,-0.75902,-0.76542,-0.78837,-0.79806,-0.76693,-0.68695,-0.57813,-0.46644,-0.36322,-0.25905,-0.12603,0.057219,0.28112,0.5064,0.67724,0.74668,0.70206,0.56363,0.36964,0.1584,-0.051191,-0.25713,-0.45896,-0.64997,-0.80996,-0.91321,-0.95102,-0.93676,-0.90047,-0.87798,-0.88439,-0.90783,-0.92439,-0.91281,-0.87286,-0.8286,-0.80716,-0.82034,-0.85695,-0.88747,-0.88661,-0.85252,-0.80633,-0.7774,-0.7841,-0.81891,-0.85302,-0.85904,-0.8283,-0.77738,-0.73742,-0.73034,-0.7561,-0.79068,-0.80349,-0.78203,-0.73658,-0.69435,-0.68151,-0.70084,-0.73258,-0.74911,-0.73246,-0.68998,-0.64801,-0.63101,-0.64641,-0.6773,-0.6936,-0.67657,-0.62981,-0.57664,-0.54637,-0.55045,-0.57446,-0.59152,-0.57775,-0.53001,-0.4711,-0.42924,-0.41928,-0.43425,-0.44681,-0.43068,-0.38091,-0.314,-0.25855,-0.23601,-0.24334,-0.25868,-0.25671,-0.22367,-0.17033,-0.12344,-0.10569,-0.12425,-0.16338,-0.1936,-0.19683,-0.17614,-0.15344,-0.15879,-0.20368,-0.27221,-0.33546,-0.3683,-0.3689,-0.36232,-0.37778,-0.42769,-0.49973,-0.56288,-0.59224,-0.5879,-0.57188,-0.57412,-0.61099,-0.67175,-0.72877,-0.756,-0.74465,-0.71178,-0.68701,-0.6909,-0.72442,-0.7664,-0.78764,-0.77492,-0.73842,-0.70464,-0.70006,-0.72907,-0.77062,-0.79535,-0.78463,-0.74567,-0.70765,-0.69766,-0.7226,-0.76427,-0.79051,-0.78154,-0.74318,-0.70048,-0.68316,-0.70197,-0.74006,-0.76968,-0.7684,-0.73473,-0.69338,-0.67284,-0.68598,-0.72394,-0.75819,-0.76265,-0.73438,-0.69224,-0.66594,-0.67561,-0.71448,-0.7562,-0.77258,-0.75081,-0.7055,-0.66682,-0.65808,-0.68322,-0.72198,-0.74381,-0.73309,-0.69671,-0.65906,-0.64814,-0.67142,-0.71178,-0.74201,-0.74035,-0.7073,-0.66646,-0.64434,-0.65334,-0.68329,-0.70566,-0.69646,-0.65365,-0.59718,-0.55869,-0.55814,-0.58708,-0.61768,-0.61991,-0.58073,-0.51731,-0.46074,-0.43239,-0.43449,-0.44604,-0.44055,-0.41105,-0.37075,-0.34394,-0.3508,-0.38811,-0.43307,-0.46102,-0.45872,-0.43595,-0.41984,-0.43337,-0.48267,-0.55183,-0.61031,-0.63711,-0.63377,-0.62159,-0.63058,-0.67492,-0.74053,-0.79783,-0.81904,-0.79853,-0.75945,-0.73451,-0.74453,-0.78338,-0.8226,-0.83447,-0.80996,-0.76632,-0.73568,-0.73994,-0.77627,-0.82067,-0.84422,-0.83129,-0.79194,-0.7544,-0.74374,-0.76786,-0.80891,-0.83141,-0.81046,-0.74659,-0.66464,-0.59935,-0.56044,-0.52064,-0.43753,-0.28236,-0.06682,0.16036,0.35317,0.4967,0.60537,0.69751,0.76004,0.74664,0.61466,0.36051,0.034034,-0.28344,-0.52723,-0.67551,-0.74634,-0.78019,-0.80992,-0.84657,-0.88663,-0.91439,-0.9137,-0.88342,-0.8365,-0.79698,-0.78902,-0.81568,-0.85655,-0.8822,-0.87193,-0.83063,-0.78632,-0.76744,-0.78265,-0.81614,-0.83797,-0.82548,-0.78193,-0.73248,-0.70561,-0.71508,-0.74755,-0.77366,-0.7682,-0.72792,-0.67707,-0.64641,-0.65234,-0.68707,-0.72088,-0.72584,-0.69628,-0.64958,-0.61581,-0.61549,-0.64347,-0.67557,-0.68439,-0.65745,-0.60848,-0.56537,-0.5503,-0.56706,-0.59554,-0.60588,-0.5824,-0.53151,-0.47776,-0.44942,-0.45402,-0.47392,-0.48099,-0.45337,-0.39311,-0.32627,-0.28095,-0.26908,-0.279,-0.28181,-0.25544,-0.20111,-0.14031,-0.10246,-0.10308,-0.13087,-0.15931,-0.16363,-0.13676,-0.098473,-0.078759,-0.095839,-0.14786,-0.21002,-0.25176,-0.26175,-0.25137,-0.24701,-0.27372,-0.33348,-0.40485,-0.45986,-0.48073,-0.47414,-0.46726,-0.48566,-0.53657,-0.60345,-0.65506,-0.66959,-0.64983,-0.61962,-0.60983,-0.63581,-0.68525,-0.72991,-0.74405,-0.72157,-0.68326,-0.6598,-0.66952,-0.70779,-0.74793,-0.76028,-0.73566,-0.69012,-0.65456,-0.65414,-0.68744,-0.72876,-0.74705,-0.72645,-0.68044,-0.64153,-0.63558,-0.66594,-0.70921,-0.73087,-0.7141,-0.66865,-0.62287,-0.6078,-0.63101,-0.67253,-0.70272,-0.69924,-0.66399,-0.62345,-0.606,-0.62367,-0.66468,-0.69896,-0.70216,-0.67284,-0.63104,-0.60686,-0.61788,-0.65519,-0.69306,-0.70513,-0.68187,-0.64039,-0.6093,-0.60842,-0.63813,-0.67558,-0.69169,-0.6746,-0.63506,-0.60052,-0.59684,-0.62603,-0.66558,-0.68486,-0.66466,-0.61343,-0.56141,-0.53663,-0.54759,-0.57733,-0.59482,-0.5811,-0.54086,-0.4959,-0.47179,-0.47597,-0.49112,-0.49235,-0.46179,-0.4018,-0.33909,-0.3029,-0.3065,-0.34157,-0.37951,-0.39224,-0.37364,-0.34011,-0.32113,-0.33949,-0.39172,-0.45296,-0.49445,-0.50145,-0.48692,-0.48098,-0.5069,-0.56746,-0.64023,-0.69174,-0.7041,-0.68424,-0.65833,-0.65548,-0.68463,-0.73058,-0.76497,-0.76625,-0.73735,-0.70086,-0.6845,-0.70265,-0.74311,-0.77705,-0.78048,-0.75098,-0.70881,-0.6842,-0.69551,-0.7341,-0.77296,-0.7837,-0.75302,-0.695,-0.63852,-0.60497,-0.59585,-0.58365,-0.52659,-0.40058,-0.21283,0.00033973,0.19549,0.35761,0.50562,0.66535,0.83619,0.96932,0.98896,0.84726,0.5606,0.20744,-0.11384,-0.34411,-0.48545,-0.57944,-0.67066,-0.77154,-0.85985,-0.90837,-0.9053,-0.86375,-0.81807,-0.79774,-0.81194,-0.84947,-0.88268,-0.88697,-0.85918,-0.81663,-0.78712,-0.79094,-0.82396,-0.86052,-0.87316,-0.85058,-0.80501,-0.76642,-0.75951,-0.78504,-0.82211,-0.83988,-0.82035,-0.77153,-0.72126,-0.70124,-0.72118,-0.76241,-0.79354,-0.78919,-0.75037,-0.70464,-0.68242,-0.69677,-0.73366,-0.76017,-0.75125,-0.70696,-0.65087,-0.61602,-0.61967,-0.65074,-0.68096,-0.6822,-0.64572,-0.59079,-0.54744,-0.53517,-0.55257,-0.57443,-0.57071,-0.53108,-0.46831,-0.41083,-0.38466,-0.39108,-0.40763,-0.40555,-0.36707,-0.30105,-0.23784,-0.20554,-0.21362,-0.2455,-0.26736,-0.25552,-0.21169,-0.16024,-0.13573,-0.15584,-0.20734,-0.26043,-0.28632,-0.27746,-0.25746,-0.25898,-0.30029,-0.37511,-0.45275,-0.50112,-0.51179,-0.50165,-0.50173,-0.53582,-0.60014,-0.66824,-0.71059,-0.71326,-0.69039,-0.67384,-0.6882,-0.73596,-0.7947,-0.83129,-0.82873,-0.79647,-0.76217,-0.75553,-0.78434,-0.82859,-0.85797,-0.85106,-0.81093,-0.76567,-0.74578,-0.76328,-0.80492,-0.83882,-0.83873,-0.8034,-0.75479,-0.72503,-0.73341,-0.77068,-0.80922,-0.82076,-0.79433,-0.74785,-0.71231,-0.70883,-0.73884,-0.77863,-0.79643,-0.77922,-0.73716,-0.69781,-0.68932,-0.71583,-0.7565,-0.7821,-0.77258,-0.73435,-0.69586,-0.68401,-0.7078,-0.75079,-0.78093,-0.77722,-0.74275,-0.70115,-0.68323,-0.7019,-0.7425,-0.77718,-0.78105,-0.7503,-0.70834,-0.68482,-0.69574,-0.73429,-0.77174,-0.77949,-0.75054,-0.70074,-0.65941,-0.64879,-0.66553,-0.68665,-0.68669,-0.65416,-0.60371,-0.564,-0.55415,-0.5731,-0.5967,-0.59287,-0.54975,-0.48163,-0.41938,-0.39535,-0.4158,-0.45743,-0.48791,-0.484,-0.44924,-0.41388,-0.40842,-0.4436,-0.50462,-0.55861,-0.58134,-0.57478,-0.56176,-0.57213,-0.62021,-0.69182,-0.75792,-0.79235,-0.78761,-0.76321,-0.74892,-0.76398,-0.80696,-0.85396,-0.87695,-0.86372,-0.82557,-0.79197,-0.78786,-0.8164,-0.85818,-0.88292,-0.8719,-0.83301,-0.79503,-0.78472,-0.8092,-0.85112,-0.87939,-0.87496,-0.84213,-0.80153,-0.77476,-0.76713,-0.76621,-0.75157,-0.70075,-0.59849,-0.44634,-0.26372,-0.083694,0.068006,0.19874,0.34344,0.52697,0.72132,0.83766,0.78389,0.54407,0.2029,-0.11041,-0.32113,-0.4616,-0.61653,-0.81626,-0.9829,-0.98209,-0.74708,-0.35915};
void setup() {
// put your setup code here, to run once:
  Serial.begin(9600);
}


void loop() {
//a) 4-point moving average filter

  float y[len];
  int c=0;
  for(int j=0; j<(len-4); j++){
    float sum = 0;
    for(int k=c; k<c+4; k++){
      sum= sum+ ecg[k];
    }
    y[c]= sum;
    c=c+1;
  }
  
  for(int l=0; l<4; l++){
    float sum= 0;
    for(int k=c; k<c+4-l; k++){
      sum=sum+ecg[k];
    }
    y[c]=sum;
    c=c+1;
  }

  for(int q=0;q<len;q++){
    y[q]=y[q]/4;
  }

  for(int l=0; l<len;l++){
    //Serial.print(ecg[l]);
    //Serial.print(',');
    //Serial.println(y[l]+5);

  }

//b)
  // Autocorrelation function..................................................
 
  float sum=0;
  for ( int k=0;k<len;k++){
  sum=sum+y[k];
  }
  float mean=sum/len;
  for ( int k=0;k<len;k++){
  y[k]=y[k]-mean;
  }
  int sample;
  float z[len];
  for (int i=0;i<len;i++){
    float temp=0;
    for(int j=0;j<len-i;j++){
      temp=temp+(y[j]*y[j+i]);
      }
    z[i]=temp;  
   }

  // Normalising ACF.......................................................................
 
  float maximum=z[0];
  for ( int k=0;k<len;k++){
    z[k]=z[k]/maximum;
    }

    // Zero Crossing........................................................................
    int zero_cross;
    for( int m=0; m<len; m++){
      if(z[m]*z[m+1]<0){
      zero_cross=m;
      break;
    }
  }
 
  // Maxima and Pulse Rate................................................................
  for ( int i=zero_cross;i<len;i++){
    if ( (z[i-zero_cross] < z[i]) && (z[i+zero_cross] < z[i]) && z[i]>0 ) {
      sample=i;
      break;
      }
    }
   
    float pulserate=60*125/sample;
    Serial.print(pulserate);
}
